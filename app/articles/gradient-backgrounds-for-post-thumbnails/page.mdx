export const metadata = {
  title: "Gradient Backgrounds for Post Thumbnails",
  description: `I think it's finally time to remove these tacky under construction GIFs and make some changes around here! Check out this article to see how I did it!`,
  date: "Mar 29, 2024",
  authors: ["Anthony Coffey"],
};

When I first created this site, I was creating post thumbnails in Photoshop using
a PSD template that I created. This was a time-consuming process and I was never quite happy with the results.

My gut was telling me at the time to pursue a more programmatic approach to creating the design I wanted, but I ignored it.
It's been driving me crazy for weeks now, so lets take a look at how we can improve this!

### The Problem

My blog templates used to display post thumbnail as a background image. However, this was a problem because I had to manually
create each image. When trying to create content on the fly, it's not very intuitive and can ultimately slow down my workflow.

First, let's take a look at the old code for the `AllArticles` component that displays a grid of post thumbnails.

_please note: tailwind classes removed from markup for clarity_

```jsx
import React from "react";
import { getAllArticles } from "utils/getArticles";
import Link from "next/link";
import Image from "next/image";
import ArticleInfo from "./ArticleInfo";

export default async function AllArticles() {
  const articles = await getAllArticles();

  return (
    <div>
      {articles.map((article) => {
        const { metadata } = article;
        const title = String(metadata.title);

        return (
          <Link key={title} href={"/articles/" + article.slug}>
            {metadata.image && (
              <Image
                className="h-66 w-full object-cover"
                src={metadata.image}
                alt={title}
              />
            )}
            <div>
              <ArticleInfo article={article} />
              <h3>{title}</h3>
              <p>{metadata.description}</p>
            </div>
          </Link>
        );
      })}
    </div>
  );
}
```

### The Solution

Let's replace the old thumbnail code with an HTML/CSS based approach that will generate background gradients for each post. This will allow me to create a unique look for each post without having to create a new image for each one.

The code below will generate a gradient background for each post. I'll explain how it works down below!

```jsx
import React from "react";
import { getAllArticles } from "utils/getArticles";
import Link from "next/link";
import ArticleInfo from "./ArticleInfo";
import generateRandomGradient from "utils/generateRandomGradient";

export default async function AllArticles() {
  const articles = await getAllArticles();

  return (
    <div>
      {articles.map((article) => {
        const { metadata, slug } = article;
        const title = String(metadata.title);
        const gradientStyle = {
          backgroundImage: generateRandomGradient(slug),
          minHeight: "250px",
        };

        return (
          <Link key={title} href={"/articles/" + article.slug}>
            <div style={gradientStyle}>
              <h3 className="post-title">{title}</h3>
            </div>
            <div className="p-2 m-2">
              <ArticleInfo article={article} />
              <p>{metadata.description}</p>
            </div>
          </Link>
        );
      })}
    </div>
  );
}
```

This code generates a random gradient for each post and sets it as the background of the post thumbnail. This will give each post a unique look without having to create a new image for each one.

### How does it work?

The core of our approach is the `generateRandomGradient` function. This function takes a seed value (typically a unique identifier like a slug or title from your data) and uses it to generate a pseudo-random gradient. Here's the function:

```js
const generateRandomGradient = (seed) => {
  const colorPairs: string[][] = [
    ["#f6d365", "#fda085"], // Pastel yellow to pastel orange
    ["#fbc2eb", "#a6c1ee"], // Pastel pink to pastel blue
    ["#e0c3fc", "#8ec5fc"], // Pastel purple to pastel sky blue
    ["#ffecd2", "#fcb69f"], // Pastel peach to pastel orange
    ["#a1c4fd", "#c2e9fb"], // Pastel blue to pastel cyan
    ["#fed6e3", "#a8edea"], // Pastel pink to pastel aqua
    ["#ff9a9e", "#fad0c4"], // Soft red to soft peach
    ["#ffecd2", "#fcb69f"], // Soft peach to soft orange
  ];

  // Ensure the seed is a string
  const validSeed = typeof seed === "string" ? seed : "";

  // Modified hash function to incorporate the position of each character
  const hash = Array.from(validSeed).reduce(
    (acc, char, index) => acc + char.charCodeAt(0) * (index + 1),
    0,
  );

  const index = hash % colorPairs.length;
  const [color1, color2] = colorPairs[index];

  // Use the hash to generate percentages for the gradient's center position
  const xPercent = hash % 100;
  const yPercent = (hash / 100) % 100;

  return `radial-gradient(circle at ${xPercent}% ${yPercent}%, ${color1}, ${color2})`;
};

export default generateRandomGradient;
```

Here is a quick breakdown of everything that's happening in the `generateRandomGradient` function:

1. _Define color pairs_: The function starts with an array of color pairs (colorPairs). Each pair consists of two colors that will be used to create the gradient. These colors are chosen to be pastel shades that transition smoothly from one to another.

2. _Ensure the seed is a string_: The function checks if the provided seed is a string. If not, it sets validSeed to an empty string. This is important because the next step involves string operations.

3. _Generate a hash from the seed_: The function uses a custom hash function to convert the validSeed into a numerical value (hash). This is done by iterating over each character in the seed, converting the character to its ASCII code using charCodeAt(0), multiplying it by its position in the string (index + 1), and adding it to an accumulator (acc). This hash is used to ensure that different seeds produce different gradients.

4. _Select a color pair based on the hash_: The function calculates an index by taking the modulus of the hash with the length of the colorPairs array. This ensures that the index is within the bounds of the array. The corresponding color pair is then selected and destructured into color1 and color2.

5. _Generate percentages for the gradient's center position_: The function calculates two percentages (xPercent and yPercent) based on the hash. These percentages determine the position of the center of the radial gradient. This adds an element of variability to the gradient based on the seed.

6. _Return the CSS radial gradient_: Finally, the function constructs a CSS radial-gradient string using the selected colors and the calculated percentages for the center position. This string can be used in CSS to set the background of an element to the generated gradient.

7. _Export the function_: The last line export default generateRandomGradient; makes the function available for import in other JavaScript modules.

Overall, this function allows for the generation of a variety of radial gradients based on a seed value, which can be useful for creating dynamic and visually appealing backgrounds in web development. Using this approach, the same gradient is returned for the same seed value, ensuring consistency across multiple uses of the function. Also, in production I've added more color combos and with the hash function, it's unlikely that the same gradient will be generated for different seeds.

### Closing Thoughts

Now that we've implemented this solution, I can create a unique look for each post without needing to create a new image for each one. This will save me time and allow me to focus on creating content rather than designing thumbnails.

Since I've utilized this function in two places, let's refactor it into a utility function that can be reused across the application. This will help keep our code DRY (Don't Repeat Yourself) and make it easier to maintain in the future.

To do this, all you have to do is create a file utils/generateRandomGradient.js and move the generateRandomGradient function into it and export it. Then, you can import it wherever you need it in your application.

To import the file, simply add the following line to the top of the file where you want to use the function:

```js
import generateRandomGradient from "utils/generateRandomGradient";
```

Thanks for reading! I hope this article has been helpful in showing you how to create unique post thumbnails using CSS gradients. Happy coding!
